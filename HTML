html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Cherrak Infinity ♾️ — Vault Gate</title>
<style>
  :root{--bg:#071827;--card:#092033;--accent:#00e0ff;--muted:#9fbcd6}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,'Segoe UI',Roboto,'Cairo',Arial;color:#eaf6ff;background:linear-gradient(180deg,#010916,var(--bg));min-height:100vh;display:flex;align-items:center;justify-content:center;padding:18px}
  .wrap{width:100%;max-width:980px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:14px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
  .header{display:flex;align-items:center;gap:12px}
  .logo{width:64px;height:64px;border-radius:12px;background:radial-gradient(circle,#042a3a,#02111a);display:flex;align-items:center;justify-content:center;font-size:30px;color:var(--accent)}
  h1{margin:0;font-size:20px;color:#bfefff}
  .small{color:var(--muted);font-size:13px}
  .center{text-align:center}
  .panel{margin-top:14px;padding:12px;border-radius:10px;background:linear-gradient(180deg,rgba(0,0,0,0.18),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
  input,select,button,textarea{font-size:15px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  .row{display:flex;gap:8px;align-items:center}
  .btn{background:var(--accent);color:#001;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--accent)}
  .apps{display:grid;gap:10px;margin-top:10px}
  .app{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)}
  .thumb{width:48px;height:48px;border-radius:8px;background:#00161c;display:flex;align-items:center;justify-content:center;font-weight:700}
  .hidden{display:none}
  pre{background:#021219;padding:10px;border-radius:8px;color:#bfefff;max-height:160px;overflow:auto}
  .danger{color:#ff9b9b}
  footer{margin-top:12px;font-size:13px;color:var(--muted);text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="logo">♾️</div>
      <div>
        <h1>Cherrak Infinity — بوابة الخزنة</h1>
        <div class="small">افتح الخزنة بكلمة المرور ثم استمتع بالمحتوى الداخلي — و سيتم قفل الباب تلقائيًا عند الخروج.</div>
      </div>
      <div style="margin-left:auto" class="small">الساعة: <span id="clock"></span></div>
    </div>

    <!-- Gate Panel -->
    <div id="gatePanel" class="panel center">
      <h3>🔐 افتح الخزنة</h3>
      <div class="small">أدخل كلمة المرور (Password) بالعربية/الإنجليزية</div>
      <div style="margin-top:10px" class="row">
        <input id="password" placeholder="Bismillah" style="flex:1">
        <button id="unlock" class="btn">افتح</button>
      </div>
      <div style="margin-top:10px" class="small">العمر مطلوب (≥12)</div>
      <div id="gateMsg" class="small danger" style="margin-top:8px"></div>
    </div>

    <!-- Vault Panel -->
    <div id="vaultPanel" class="panel hidden">
      <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
        <div>
          <strong>🔓 الخزنة مفتوحة</strong>
          <div class="small">محتويات آمنة ومصفاة للأطفال — سيتم القفل عند الخروج من الصفحة.</div>
        </div>
        <div class="row">
          <button id="lockBtn" class="ghost">قفل الخزنة</button>
          <button id="logoutBtn" class="btn">تسجيل خروج</button>
        </div>
      </div>

      <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <input id="appTitle" class="" placeholder="اسم التطبيق/الموقع" style="flex:1">
        <input id="appUrl" placeholder="https://example.com" style="flex:1">
        <button id="addApp" class="btn">أضف</button>
      </div>

      <div class="apps" id="appsList" style="margin-top:12px"></div>

      <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

      <div>
        <strong>سجل الدخول المحلي (Audit log)</strong>
        <pre id="logArea">السجل فارغ</pre>
      </div>
    </div>

    <footer>© Cherrak Infinity — Local-first • Privacy-focused</footer>
  </div>

<script>
/* ====== Configuration & Keys ====== */
const KEYS = {APPS:'cherrak_vault_apps_v1', LOG:'cherrak_vault_log_v1', STATE:'cherrak_vault_state_v1'};
const PASSWORD = 'Bismillah'; // كلمة المرور المطلوبة (حرفي)
const MIN_AGE = 12;
const AUTO_LOCK_MS = 2 * 60 * 1000; // 2 minutes inactivity auto-lock

/* ====== Clock ====== */
function updateClock(){ document.getElementById('clock').textContent = new Date().toLocaleTimeString(); }
setInterval(updateClock,1000); updateClock();

/* ====== Utilities ====== */
function log(type,detail=''){ const arr = JSON.parse(localStorage.getItem(KEYS.LOG)||'[]'); arr.push({t:Date.now(),time:new Date().toLocaleString(),type,detail}); localStorage.setItem(KEYS.LOG, JSON.stringify(arr)); renderLog(); }
function renderLog(){ const arr = JSON.parse(localStorage.getItem(KEYS.LOG)||'[]'); const el = document.getElementById('logArea'); if(arr.length===0) el.textContent='السجل فارغ'; else el.textContent = arr.slice().reverse().map(i=>`[${i.time}] ${i.type} — ${i.detail}`).join('\\n'); }
function getApps(){ return JSON.parse(localStorage.getItem(KEYS.APPS)||'[]'); }
function setApps(a){ localStorage.setItem(KEYS.APPS, JSON.stringify(a)); renderApps(); }

/* ====== Render Apps ====== */
function renderApps(){
  const el = document.getElementById('appsList'); el.innerHTML = '';
  const apps = getApps();
  if(apps.length===0){ el.innerHTML = '<div class="small">لا توجد تطبيقات — أضف الآن</div>'; return; }
  apps.forEach((a)=>{
    const d = document.createElement('div'); d.className='app';
    const thumb = document.createElement('div'); thumb.className='thumb'; thumb.textContent = (a.title||'').slice(0,2).toUpperCase();
    const meta = document.createElement('div'); meta.style.flex='1'; meta.innerHTML = `<strong>${a.title}</strong><div class="small">${a.url}</div>`;
    const btns = document.createElement('div'); btns.className='row';
    const open = document.createElement('button'); open.className='btn'; open.textContent='فتح'; open.onclick = ()=> openSite(a.url);
    const del = document.createElement('button'); del.className='ghost'; del.textContent='حذف'; del.onclick = ()=> { if(confirm('حذف؟')) removeApp(a.id); };
    btns.appendChild(open); btns.appendChild(del);
    d.appendChild(thumb); d.appendChild(meta); d.appendChild(btns);
    el.appendChild(d);
  });
}

/* ====== Add / Remove App ====== */
function addApp(title,url){
  if(!title || !url) return alert('املأ الاسم والرابط');
  const arr = getApps();
  arr.unshift({id:Date.now(),title,url});
  setApps(arr); log('app_added', `${title} | ${url}`);
}
function removeApp(id){
  const arr = getApps().filter(a=>a.id!==id);
  setApps(arr); log('app_removed', id);
}

/* ====== Open site (try embed or new tab) ====== */
function openSite(url){
  // Simple blocked-words check (you can extend)
  const blocked = ['porn','sex','xxx','malware','virus'];
  const low = (url||'').toLowerCase();
  for(const b of blocked) if(low.includes(b)) { alert('محتوى محظور'); log('open_blocked', b); return; }
  // try to open embedded window (many sites block iframe). We'll open a popup with iframe to attempt embed.
  const w = window.open('', '_blank', 'width=1000,height=700');
  try{
    w.document.write(`<style>body{margin:0;background:#001b23;color:#eaf6ff;font-family:system-ui}iframe{width:100%;height:100vh;border:none}</style><iframe src="${url}"></iframe>`);
  }catch(e){
    // fallback: just open URL
    window.open(url,'_blank');
  }
  log('open_site', url);
}

/* ====== Gate Logic ====== */
const gatePanel = document.getElementById('gatePanel');
const vaultPanel = document.getElementById('vaultPanel');
const gateMsg = document.getElementById('gateMsg');
const passwordInput = document.getElementById('password');
const unlockBtn = document.getElementById('unlock');
const lockBtn = document.getElementById('lockBtn');
const logoutBtn = document.getElementById('logoutBtn');

let inactivityTimer = null;

function setAutoLockTimer(){
  clearAutoLockTimer();
  inactivityTimer = setTimeout(()=>{ autoLock('inactivity'); }, AUTO_LOCK_MS);
}
function clearAutoLockTimer(){ if(inactivityTimer) { clearTimeout(inactivityTimer); inactivityTimer = null; } }

function autoLock(reason){
  // Close vault and show gate
  vaultPanel.classList.add('hidden');
  gatePanel.classList.remove('hidden');
  localStorage.setItem(KEYS.STATE, JSON.stringify({open:false}));
  log('auto_lock', reason);
  alert('تم قفل الخزنة — ' + (reason==='visibility'?'غادرت الصفحة':'انتهاء فترة النشاط'));
}

function unlockSequence(){
  // mark as open
  localStorage.setItem(KEYS.STATE, JSON.stringify({open:true,openedAt:Date.now()}));
  gatePanel.classList.add('hidden');
  vaultPanel.classList.remove('hidden');
  log('unlock_success', 'user opened vault');
  setAutoLockTimer();
}

/* Unlock handler */
unlockBtn.addEventListener('click', ()=>{
  const pass = passwordInput.value.trim();
  if(pass !== PASSWORD){ gateMsg.textContent = '❌ كلمة مرور خاطئة'; log('unlock_failed','wrong_password'); return; }
  const age = Number(prompt('أدخل عمرك (سنة):',''));
  if(isNaN(age) || age < MIN_AGE){ gateMsg.textContent = `🚫 ممنوع — العمر أقل من ${MIN_AGE}`; log('unlock_failed','age_'+age); return; }
  gateMsg.textContent = '';
  passwordInput.value = '';
  unlockSequence();
});

/* Lock handlers */
lockBtn.addEventListener('click', ()=>{ autoLock('manual_lock'); });
logoutBtn.addEventListener('click', ()=>{ autoLock('user_logout'); });

/* Activity detection to reset auto-lock timer */
['mousemove','keydown','touchstart'].forEach(ev=>{
  document.addEventListener(ev, ()=>{ if(localStorage.getItem(KEYS.STATE) && JSON.parse(localStorage.getItem(KEYS.STATE)).open) setAutoLockTimer(); });
});

/* Visibility change: lock when user leaves tab (instant) */
document.addEventListener('visibilitychange', ()=>{
  if(document.hidden && localStorage.getItem(KEYS.STATE) && JSON.parse(localStorage.getItem(KEYS.STATE)).open){
    autoLock('visibility');
  }
});

/* On load: restore state & render UI */
(function init(){
  renderLog();
  renderApps();
  const state = JSON.parse(localStorage.getItem(KEYS.STATE) || '{}');
  if(state.open){
    // If previously open, we choose to require unlock again for security (or you can auto-open)
    // For security we keep vault locked on page reload
    localStorage.setItem(KEYS.STATE, JSON.stringify({open:false}));
    gatePanel.classList.remove('hidden'); vaultPanel.classList.add('hidden');
  } else {
    gatePanel.classList.remove('hidden'); vaultPanel.classList.add('hidden');
  }
})();

/* Add app button */
document.getElementById('addApp').addEventListener('click', ()=>{
  const t = document.getElementById('appTitle').value.trim();
  let u = document.getElementById('appUrl').value.trim();
  if(!t || !u) return alert('املأ الاسم والرابط');
  if(!/^https?:\/\//i.test(u)) u = 'https://' + u;
  addApp(t,u);
  document.getElementById('appTitle').value=''; document.getElementById('appUrl').value='';
});

/* Expose some functions for dev console if needed */
window.cherrak = { addApp, getApps, setApps, log };

</script>
</body>
</html>
