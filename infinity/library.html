<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Cherrak Infinity — المكتبة والتطبيقات</title>
<style>
  body{font-family:"Tajawal",Arial;background:#04102a;color:#e9f6ff;margin:0;padding:18px}
  header{display:flex;justify-content:space-between;align-items:center}
  .logo{font-size:34px}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin-top:18px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .chip{padding:8px 10px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);cursor:pointer}
  .top-stats{display:flex;gap:12px;align-items:center}
  .search{margin-top:12px;display:flex;gap:8px}
  input{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
</style>
</head>
<body>
  <header>
    <div>
      <div class="logo">🧲 Cherrak Infinity ♾️</div>
      <div class="top-stats"><div>المستخدمون: <strong id="users">12,847</strong></div><div style="margin-left:12px">الأرباح: <strong id="earn">$127,430</strong></div></div>
    </div>
    <div>
      <button id="back" class="chip">🔙 خروج إلى البوابة</button>
    </div>
  </header>

  <div class="search">
    <input id="q" placeholder="ابحث في المكتبة أو التطبيقات..." />
    <button id="searchBtn" class="chip">🔎 بحث</button>
  </div>

  <h3 style="margin-top:18px">المكتبة التعليمية</h3>
  <div id="libGrid" class="grid"></div>

  <h3 style="margin-top:18px">التطبيقات العالمية</h3>
  <div id="appsGrid" class="grid"></div>

  <h3 style="margin-top:18px">أدوات AI (محاكاة)</h3>
  <div id="aiGrid" class="grid"></div>

  <!-- Firebase SDK -->
  <script type="module">
    // ====== نفس Firebase config من index.html =====
    const firebaseConfig = {
      apiKey: "FIREBASE_API_KEY",
      authDomain: "FIREBASE_AUTH_DOMAIN",
      projectId: "FIREBASE_PROJECT_ID",
      storageBucket: "FIREBASE_STORAGE_BUCKET",
      messagingSenderId: "FIREBASE_MESSAGING_SENDER_ID",
      appId: "FIREBASE_APP_ID"
    };
    // =============================================

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    document.getElementById('back').addEventListener('click', async ()=>{
      // logout then go back
      try{ await signOut(auth); }catch(e){}
      location.href = '../index.html';
    });

    // helpers to render cards
    function cardHtml(title,desc,action){
      const el = document.createElement('div'); el.className='card';
      el.innerHTML = `<div style="font-weight:800">${title}</div><div style="color:#9fb6d9;margin-top:8px">${desc}</div><div style="margin-top:10px"><button class="chip">${action}</button></div>`;
      return el;
    }

    async function loadLibrary(){
      // reads Firestore collection 'library'
      try{
        const snap = await getDocs(collection(db, 'library'));
        const grid = document.getElementById('libGrid'); grid.innerHTML='';
        snap.forEach(doc=>{
          const d = doc.data();
          const el = cardHtml(d.title || 'عنوان', d.desc || 'وصف', 'فتح');
          el.querySelector('button').addEventListener('click', ()=> alert('فتح المورد: '+(d.title||'')));
          grid.appendChild(el);
        });
      }catch(err){ console.error(err); document.getElementById('libGrid').innerHTML = '<div class="card">لا توجد بيانات — أضف سجلات في Firestore (collection: library)</div>'; }
    }

    async function loadApps(){
      try{
        const snap = await getDocs(collection(db,'apps'));
        const grid = document.getElementById('appsGrid'); grid.innerHTML='';
        snap.forEach(doc=>{
          const d = doc.data();
          const el = cardHtml(d.name || 'app', d.desc || 'app desc', 'فتح');
          el.querySelector('button').addEventListener('click', ()=> window.open(d.url || '#','_blank'));
          grid.appendChild(el);
        });
      }catch(err){ console.error(err); }
    }

    async function loadAi(){
      try{
        const snap = await getDocs(collection(db,'ai_tools'));
        const grid = document.getElementById('aiGrid'); grid.innerHTML='';
        snap.forEach(doc=>{
          const d = doc.data();
          const el = cardHtml(d.name || 'AI', d.desc || 'desc', 'تشغيل');
          el.querySelector('button').addEventListener('click', ()=> alert('محاكاة أداة: '+(d.name||'')));
          grid.appendChild(el);
        });
      }catch(err){ console.error(err); }
    }

    // search simple
    document.getElementById('searchBtn').addEventListener('click', ()=>{
      const q = (document.getElementById('q').value||'').toLowerCase();
      if(!q) return alert('اكتب كلمات البحث');
      // search on displayed cards only
      Array.from(document.querySelectorAll('.card')).forEach(c=>{
        const txt = c.textContent.toLowerCase();
        c.style.display = txt.includes(q) ? '' : 'none';
      });
    });

    // init load
    loadLibrary(); loadApps(); loadAi();

  </script>
</body>
</html>
