lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Cherrak Infinity â™¾ï¸ â€” Vault Library + Magnet</title>
<meta name="description" content="Cherrak Infinity â€” Vault: global apps & sites library (banks, stores, games, socials, AI). Magnet pulls public links (DuckDuckGo, Wikipedia) into vault."/>
<style>
:root{
  --bg:#030617; --panel:#071827; --accent:#00e0ff; --muted:#9fbcd6; --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
body{
  margin:0;font-family: "Cairo", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  background: radial-gradient(circle at 20% 10%, rgba(0,50,70,0.4), #000315 60%), linear-gradient(180deg, #001018, #000);
  color:#eaf6ff; min-height:100vh; display:flex;align-items:center;justify-content:center;padding:18px;
}
.app{width:100%; max-width:1200px; border-radius:12px; overflow:hidden;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
  border:1px solid rgba(255,255,255,0.03); box-shadow:0 18px 60px rgba(0,0,0,0.6);
}

/* header */
.header{display:flex;gap:12px;align-items:center;padding:18px}
.logo{width:64px;height:64px;border-radius:12px;background:radial-gradient(circle,#042a3a,#02111a);display:flex;align-items:center;justify-content:center;font-size:30px;color:var(--accent)}
.title{flex:1}
.title h1{margin:0;font-size:20px;color:#bfefff}
.title p{margin:0;color:var(--muted);font-size:13px}
.clock{font-size:13px;color:var(--muted)}

/* hero */
.hero{display:flex;gap:18px;padding:12px 18px 0 18px;align-items:flex-start}
.robot-wrap{width:140px;min-width:120px;display:flex;align-items:center;justify-content:center}
.robot{width:120px;height:120px;background:#021821;border-radius:12px;background-size:cover;background-position:center;box-shadow:0 8px 30px rgba(0,200,255,0.06);transition:transform .6s}
.robot.animate{transform:translateY(-8px) rotate(-6deg); filter: drop-shadow(0 10px 40px rgba(0,200,255,0.08));}

/* vault center */
.center{flex:1; display:flex; flex-direction:column; align-items:center; gap:12px; padding-bottom:18px}
.vault{width:640px;max-width:85vw;height:420px;border-radius:12px;position:relative; background:#021827; display:flex; align-items:center; justify-content:center; box-shadow:0 18px 60px rgba(0,0,0,0.6); overflow:hidden}
.vault-bg{position:absolute;inset:0;background-size:cover;background-position:center;opacity:.95}
.vault.glow::after{content:"";position:absolute;inset:-6px;border-radius:14px;box-shadow:0 0 160px 50px rgba(0,200,255,0.14), inset 0 0 80px rgba(0,200,255,0.08);pointer-events:none;transition:opacity .5s}
.door-panel{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);width:88%;max-width:520px;background:linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.35));padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
.door-panel h2{margin:0;color:#e8f8ff}
.door-panel p{margin:6px 0;color:var(--muted);font-size:13px}

/* right: user image / owner */
.right{width:180px;min-width:140px;display:flex;flex-direction:column;align-items:center;padding-right:12px;gap:10px}
.me-photo{width:110px;height:110px;border-radius:12px;background:#041623;background-size:cover;background-position:center;border:2px solid rgba(255,255,255,0.04)}
.owner-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer}

/* magnet area */
.magnet{margin-top:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.02)}
.magnet .row{gap:6px}

/* inputs & buttons */
.row{display:flex;gap:8px;align-items:center}
input[type="password"], input[type="number"], input[type="text"]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:inherit;font-size:14px}
.btn{background:linear-gradient(90deg,var(--accent),#0072ff);border:none;color:#001;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.05);color:var(--muted)}

/* bottom library */
.library{padding:12px 18px;border-top:1px solid rgba(255,255,255,0.02)}
.library h3{margin:0;color:#bfefff}
.apps-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;margin-top:12px}
.app-card{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;display:flex;align-items:center;gap:10px;border:1px solid rgba(255,255,255,0.02)}
.app-thumb{width:44px;height:44px;border-radius:8px;background:#00161c;display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent)}
.app-meta{flex:1}
.app-meta b{display:block;font-size:14px}
.app-meta span{display:block;color:var(--muted);font-size:12px}
.app-actions{display:flex;gap:8px}

/* magnet results */
.magnet-results{margin-top:10px;display:grid;gap:8px;max-height:220px;overflow:auto}
.result-card{background:rgba(0,0,0,0.25);padding:8px;border-radius:8px;display:flex;justify-content:space-between;align-items:center}
.result-meta{max-width:75%}
.result-meta b{display:block}
.result-meta small{display:block;color:var(--muted);font-size:12px}

/* log */
.log{margin-top:12px;background:rgba(0,0,0,0.25);padding:10px;border-radius:8px;max-height:160px;overflow:auto;color:var(--muted);font-size:13px}

/* tagline */
.tagline{padding:12px;text-align:center;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);color:#cfe9ff;font-size:15px}

/* responsive */
@media (max-width:980px){
  .hero{flex-direction:column;align-items:center}
  .right{order:3}
  .robot-wrap{order:1}
  .center{order:2}
  .vault{width:92vw;height:56vh}
}
</style>
</head>
<body>
<div class="app" role="application" aria-label="Cherrak Infinity Vault Library">
  <div class="header">
    <div class="logo">â™¾ï¸</div>
    <div class="title">
      <h1>Cherrak Infinity â™¾ï¸ â€” Vault Library</h1>
      <p>Ù…ÙˆÙ‚Ø¹ Ø´Ø§Ù…Ù„: Ø¨Ù†ÙˆÙƒØŒ Ø¨Ø·Ø§Ù‚Ø§ØªØŒ Ù…ØªØ§Ø¬Ø±ØŒ Ø£Ù„Ø¹Ø§Ø¨ØŒ Ø´Ø¨ÙƒØ§Øª Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©ØŒ ÙˆØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø°ÙƒÙŠØ©</p>
    </div>
    <div class="clock" id="clock">--:--:--</div>
  </div>

  <div class="hero">
    <div class="robot-wrap"><div id="robot" class="robot" style="background-image:url('robot.png')" title="Cherrak Robot"></div></div>

    <div class="center">
      <div id="vault" class="vault" aria-hidden="false">
        <div class="vault-bg" style="background-image:url('vault.png');"></div>
        <div id="vaultContent" class="vault-content" style="display:none; position:absolute; inset:12px; border-radius:8px; padding:12px; overflow:auto; color:#eaffff;"></div>
      </div>

      <div class="door-panel" role="region" aria-label="Vault access">
        <h2>ğŸ” Ø§ÙØªØ­ Ø§Ù„Ø®Ø²Ù†Ø©</h2>
        <p>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: <strong>Bismillah</strong> â€” ÙˆÙ„Ù„Ù…Ø§Ù„Ùƒ: <strong>Cherrak Houari</strong></p>
        <div class="row" style="margin-top:8px">
          <input id="password" type="password" placeholder="Bismillah" aria-label="password">
          <input id="age" type="number" min="1" placeholder="Ø§Ù„Ø¹Ù…Ø± (Ø³Ù†Ø©)" style="width:110px" aria-label="age">
          <button id="unlockBtn" class="btn">Ø§ÙØªØ­</button>
        </div>
        <div style="margin-top:8px" id="msgArea" aria-live="polite" class="small"></div>

        <!-- Magnet UI -->
        <div class="magnet" style="margin-top:10px">
          <div style="font-weight:700">ğŸ§² Magnet â€” Ø§Ø¬Ù„Ø¨ Ù…Ø­ØªÙˆÙ‰ Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</div>
          <div class="row" style="margin-top:8px">
            <input id="magnetQuery" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ© Ø£Ùˆ Ø§Ø³Ù… Ù…ÙˆÙ‚Ø¹ (Ù…Ø«Ø§Ù„: Amazon, Fortnite, Visa)" />
            <button id="magnetBtn" class="btn">Ø¬Ø°Ø¨</button>
            <button id="magnetClear" class="btn ghost">Ù…Ø³Ø­</button>
          </div>
          <div class="small" style="margin-top:8px">Ø§Ù„Ù…ØºÙ†Ø§Ø·ÙŠØ³ ÙŠØ¬Ù„Ø¨ Ø±ÙˆØ§Ø¨Ø· ÙˆÙ…Ù„Ø®ØµØ§Øª Ù…Ù† Ù…ØµØ§Ø¯Ø± Ø¹Ø§Ù…Ø© (DuckDuckGo, Wikipedia) ÙˆÙŠØ¹Ø±Ø¶Ù‡Ø§ Ù„ØªØ¶ÙŠÙÙ‡Ø§ Ø¨Ø®Ø§Ù†Ø© Ø§Ù„Ø®Ø²Ù†Ø©. ÙŠØ­ØªØ±Ù… Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ÙˆÙ„Ø§ ÙŠØ¬Ù„Ø¨ Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠ.</div>
          <div id="magnetResults" class="magnet-results"></div>
        </div>

      </div>
    </div>

    <div class="right">
      <div id="mePhoto" class="me-photo" style="background-image:url('me.jpg')" title="Owner"></div>
      <button id="ownerQuick" class="owner-btn">ğŸ‘‘ Owner Login</button>
    </div>
  </div>

  <div class="tagline">
    An advanced, fast, and limitless AI-powered website. â€” Cherrak Infinity â™¾ï¸ â€” The Vault
  </div>

  <div class="library">
    <h3>ğŸ“š Library â€” All-in-one (Banks â€¢ Stores â€¢ Games â€¢ Socials â€¢ AI)</h3>
    <div class="apps-grid" id="appsList"></div>

    <div class="log" id="logArea">Ø§Ù„Ø³Ø¬Ù„ ÙØ§Ø±Øº</div>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const USER_PASS = 'Bismillah';
const OWNER_PASS = 'Cherrak Houari';
const MIN_AGE = 12;
const OPEN_HOUR = 8, CLOSE_HOUR = 22;
const AUTO_LOCK_MS = 5*60*1000;
const STORAGE_APPS = 'cherrak_all_apps_v1';
const STORAGE_LOG = 'cherrak_audit_v1';
const BLOCKED = ['porn','sex','xxx','erotic','pornography','hentai','rape','bestiality','torrent-malware','virus'];

/* ===== ELEMENTS ===== */
const clockEl = document.getElementById('clock');
const vaultEl = document.getElementById('vault');
const vaultContent = document.getElementById('vaultContent');
const passwordInput = document.getElementById('password');
const ageInput = document.getElementById('age');
const unlockBtn = document.getElementById('unlockBtn');
const ownerQuick = document.getElementById('ownerQuick');
const robot = document.getElementById('robot');
const appsListEl = document.getElementById('appsList');
const logArea = document.getElementById('logArea');
const msgArea = document.getElementById('msgArea');

const magnetQuery = document.getElementById('magnetQuery');
const magnetBtn = document.getElementById('magnetBtn');
const magnetResults = document.getElementById('magnetResults');
const magnetClear = document.getElementById('magnetClear');

let autoLockTimer = null;

/* ===== helpers ===== */
function nowTimeStr(){ return new Date().toLocaleTimeString(); }
function updateClock(){ clockEl.textContent = nowTimeStr(); }
setInterval(updateClock,1000); updateClock();

function inWorkingHours(){ const h = new Date().getHours(); return h >= OPEN_HOUR && h < CLOSE_HOUR; }
function speakArabic(text){ if('speechSynthesis' in window){ const u = new SpeechSynthesisUtterance(text); u.lang='ar-SA'; window.speechSynthesis.cancel(); window.speechSynthesis.speak(u);} }
function log(type, detail=''){ const arr = JSON.parse(localStorage.getItem(STORAGE_LOG)||'[]'); arr.push({t:Date.now(),time:new Date().toLocaleString(),type,detail}); localStorage.setItem(STORAGE_LOG, JSON.stringify(arr)); renderLog(); }
function renderLog(){ const arr = JSON.parse(localStorage.getItem(STORAGE_LOG)||'[]'); if(arr.length===0) logArea.textContent='Ø§Ù„Ø³Ø¬Ù„ ÙØ§Ø±Øº'; else logArea.textContent = arr.slice().reverse().map(i=>`[${i.time}] ${i.type} â€” ${i.detail}`).join('\\n'); }
function isBlocked(url){ const low = (url||'').toLowerCase(); return BLOCKED.some(b=> low.includes(b)); }

/* ===== default big apps list (banks, cards, stores, games, socials, AI, cherrak carte...) ===== */
const DEFAULT_APPS = [
  {title:'Mastercard', url:'https://www.mastercard.com', cat:'Finance'},
  {title:'Visa', url:'https://www.visa.com', cat:'Finance'},
  {title:'PayPal', url:'https://www.paypal.com', cat:'Finance'},
  {title:'Amazon', url:'https://www.amazon.com', cat:'Ecommerce'},
  {title:'Alibaba', url:'https://www.alibaba.com', cat:'Ecommerce'},
  {title:'eBay', url:'https://www.ebay.com', cat:'Ecommerce'},
  {title:'Google', url:'https://www.google.com', cat:'Search'},
  {title:'YouTube', url:'https://www.youtube.com', cat:'Social'},
  {title:'Facebook', url:'https://www.facebook.com', cat:'Social'},
  {title:'Instagram', url:'https://www.instagram.com', cat:'Social'},
  {title:'Steam', url:'https://store.steampowered.com', cat:'Games'},
  {title:'Netflix', url:'https://www.netflix.com', cat:'Media'},
  {title:'OpenAI', url:'https://www.openai.com', cat:'AI'},
  {title:'Cherrak Carte AI', url:'https://cherrakcart.ai', cat:'Cherrak'}
];
if(!localStorage.getItem(STORAGE_APPS)) localStorage.setItem(STORAGE_APPS, JSON.stringify(DEFAULT_APPS));

/* ===== render apps grid (library area) ===== */
function renderAppsGrid(){
  const arr = JSON.parse(localStorage.getItem(STORAGE_APPS)||'[]');
  appsListEl.innerHTML = '';
  if(arr.length===0){
    appsListEl.innerHTML = `<div style="color:var(--muted)">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯</div>`;
    return;
  }
  arr.forEach((a,i)=>{
    const card = document.createElement('div'); card.className='app-card';
    const thumb = document.createElement('div'); thumb.className='app-thumb'; thumb.textContent = (a.title||'').slice(0,2).toUpperCase();
    const meta = document.createElement('div'); meta.className='app-meta';
    meta.innerHTML = `<b>${a.title}</b><span>${a.cat || ''} â€” ${a.url}</span>`;
    const actions = document.createElement('div'); actions.className='app-actions';
    const open = document.createElement('button'); open.className='btn'; open.textContent='ÙØªØ­'; open.onclick = ()=> openLink(a.url);
    const copy = document.createElement('button'); copy.className='btn ghost'; copy.style.padding='8px'; copy.textContent='Ù†Ø³Ø®'; copy.onclick = ()=> { navigator.clipboard.writeText(a.url); alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·'); };
    actions.appendChild(open); actions.appendChild(copy);
    card.appendChild(thumb); card.appendChild(meta); card.appendChild(actions);
    appsListEl.appendChild(card);
  });
}

/* ===== open link with block check ===== */
function openLink(url){
  if(isBlocked(url)){ alert('Ù…Ø­ØªÙˆÙ‰ Ù…Ø­Ø¸ÙˆØ± â€” Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø®ÙˆÙ„'); log('open_blocked', url); return; }
  window.open(url,'_blank');
  log('open_site', url);
}

/* ===== vault open/close logic ===== */
function animateOpen(){
  robot.classList.add('animate');
  vaultEl.classList.add('glow');
  vaultContent.style.display='block';
}
function animateClose(){
  robot.classList.remove('animate');
  vaultEl.classList.remove('glow');
  vaultContent.style.display='none';
}

function setAutoLockTimer(){
  clearAutoLockTimer();
  autoLockTimer = setTimeout(()=>{ 
    animateClose(); 
    alert('ØªÙ… Ù‚ÙÙ„ Ø§Ù„Ø®Ø²Ù†Ø© Ù„Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø· Ø£Ùˆ Ù…ØºØ§Ø¯Ø±Ø© Ø§Ù„ØµÙØ­Ø©');
    log('auto_lock','inactivity'); 
  }, AUTO_LOCK_MS);
}
function clearAutoLockTimer(){ if(autoLockTimer){ clearTimeout(autoLockTimer); autoLockTimer=null; } }

document.addEventListener('visibilitychange', ()=>{
  if(document.hidden && vaultContent.style.display === 'block'){ animateClose(); log('auto_lock', 'tab_hidden'); }
});

/* ===== unlock handler ===== */
unlockBtn.addEventListener('click', ()=>{
  const pass = (passwordInput.value||'').trim();
  const age = Number(ageInput.value);
  msgArea.textContent = '';

  if(!inWorkingHours()){
    msgArea.textContent = `ğŸš« Ø§Ù„Ø®Ø²Ù†Ø© Ù…ÙØªÙˆØ­Ø© Ù…Ù† ${String(OPEN_HOUR).padStart(2,'0')}:00 Ø¥Ù„Ù‰ ${String(CLOSE_HOUR).padStart(2,'0')}:00`;
    log('unlock_failed','out_of_hours');
    return;
  }
  if(isNaN(age) || age < MIN_AGE){
    msgArea.textContent = `ğŸš« Ù…Ù…Ù†ÙˆØ¹ â€” Ø§Ù„Ø¹Ù…Ø± Ø£Ù‚Ù„ Ù…Ù† ${MIN_AGE}`;
    log('unlock_failed','age_'+age);
    return;
  }
  if(pass === USER_PASS || pass === OWNER_PASS){
    const who = (pass===OWNER_PASS)? 'owner':'user';
    animateOpen();
    speakArabic('Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…');
    loadVaultContent(); // fill vault content overlay
    log('unlock_success', who);
    passwordInput.value=''; ageInput.value='';
    setAutoLockTimer();
    if(who==='owner') setTimeout(()=> openOwnerPanel(), 400);
    return;
  }
  msgArea.textContent = 'âŒ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©';
  log('unlock_failed','wrong_password');
});

/* owner quick button */
ownerQuick.addEventListener('click', ()=>{
  const p = prompt('Owner password:');
  if(p === OWNER_PASS){
    if(vaultContent.style.display !== 'block'){ animateOpen(); speakArabic('Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…'); loadVaultContent(); }
    openOwnerPanel();
  } else {
    alert('Owner password incorrect'); log('owner_failed','wrong_password');
  }
});

/* owner panel via prompt */
function openOwnerPanel(){
  const action = prompt('Owner Panel â€” type: add / remove / clearlog / showlog\n- add: add global link\n- remove: remove by title\n- clearlog: clear audit log\n- showlog: show log');
  if(!action) return;
  if(action.toLowerCase() === 'add'){
    const title = prompt('Title:');
    const url = prompt('URL (https://...):');
    if(!title || !url) return alert('missing');
    if(isBlocked(url)) return alert('blocked content');
    const arr = JSON.parse(localStorage.getItem(STORAGE_APPS) || '[]');
    arr.unshift({title, url, cat:'Owner'});
    localStorage.setItem(STORAGE_APPS, JSON.stringify(arr));
    renderAppsGrid(); log('owner_add', title);
    alert('Added');
  } else if(action.toLowerCase() === 'remove'){
    const title = prompt('Title to remove:');
    if(!title) return;
    let arr = JSON.parse(localStorage.getItem(STORAGE_APPS) || '[]');
    const before = arr.length;
    arr = arr.filter(a => a.title.toLowerCase() !== title.toLowerCase());
    localStorage.setItem(STORAGE_APPS, JSON.stringify(arr));
    renderAppsGrid(); log('owner_remove', title);
    alert('Removed: ' + (before - arr.length));
  } else if(action.toLowerCase() === 'clearlog'){
    if(confirm('Clear audit log?')){ localStorage.removeItem(STORAGE_LOG); renderLog(); alert('Cleared'); log('owner_action','clearlog'); }
  } else if(action.toLowerCase() === 'showlog'){
    alert(localStorage.getItem(STORAGE_LOG) || 'Empty');
  } else {
    alert('Unknown');
  }
}

/* load vault overlay content (list + quick search) */
function loadVaultContent(){
  const apps = JSON.parse(localStorage.getItem(STORAGE_APPS) || '[]');
  const html = [];
  html.push(`<div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">`);
  html.push(`<input id="quickSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ØªØ·Ø¨ÙŠÙ‚ Ø£Ùˆ Ù…ÙˆÙ‚Ø¹..." style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:rgba(255,255,255,0.02);color:inherit">`);
  html.push(`<button id="refreshApps" class="btn" style="padding:8px">ØªØ­Ø¯ÙŠØ«</button>`);
  html.push(`</div>`);
  html.push(`<div style="margin-top:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:8px" id="vaultList">`);
  apps.forEach(a=>{
    html.push(`<div style="background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;display:flex;flex-direction:column;gap:6px">`);
    html.push(`<b>${a.title}</b><small style="color:${'#9fbcd6'}">${a.cat || ''}</small>`);
    html.push(`<div style="margin-top:6px;display:flex;gap:6px"><button class="btn" data-url="${a.url}">ÙØªØ­</button><button class="btn ghost" data-url="${a.url}">Ù†Ø³Ø®</button></div>`);
    html.push(`</div>`);
  });
  html.push(`</div>`);
  vaultContent.innerHTML = html.join('');
  document.getElementById('refreshApps').addEventListener('click', renderVaultList);
  document.getElementById('quickSearch').addEventListener('input', (e)=> filterVault(e.target.value));
  Array.from(vaultContent.querySelectorAll('button[data-url]')).forEach(b=>{
    b.addEventListener('click', (ev)=>{
      const u = ev.currentTarget.getAttribute('data-url');
      if(ev.currentTarget.classList.contains('ghost')){ navigator.clipboard.writeText(u); alert('Copied'); return; }
      if(isBlocked(u)){ alert('Ù…Ø­ØªÙˆÙ‰ Ù…Ø­Ø¸ÙˆØ±'); log('open_blocked', u); return; }
      window.open(u,'_blank'); log('open_site', u);
    });
  });
}

/* helper render functions */
function renderVaultList(){ loadVaultContent(); }
function filterVault(q){
  q = (q||'').toLowerCase();
  const cards = vaultContent.querySelectorAll('[data-url]');
  cards.forEach(btn=>{
    const card = btn.closest('div');
    const txt = card.innerText.toLowerCase();
    card.style.display = txt.includes(q) ? '' : 'none';
  });
}

/* ===== MAGNET: aggregate from DuckDuckGo Instant Answer & Wikipedia search ===== */

/*
  Strategy:
  - DuckDuckGo Instant Answer API: https://api.duckduckgo.com/?q=QUERY&format=json&no_html=1&skip_disambig=1&origin=*
  - Wikipedia search: use action=query&list=search with origin=*
  - Also provide ready search links for Google / YouTube
  - Present aggregated results, allow user to "Add to Vault" (saved legally as link + title)
*/

async function magnetPull(query){
  if(!query || query.trim().length < 2) return alert('Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø¨Ø­Ø« Ø£Ø·ÙˆÙ„');
  magnetResults.innerHTML = `<div style="color:var(--muted)">Ø¬Ù„Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬... (${query})</div>`;
  log('magnet_search', query);
  const results = [];

  // 1) DuckDuckGo instant answer (may return Abstract/RelatedTopics/Results)
  try{
    const ddgUrl = `https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_html=1&skip_disambig=1&origin=*`;
    const r = await fetch(ddgUrl);
    if(r.ok){
      const j = await r.json();
      // Abstract URL
      if(j.AbstractURL){ results.push({title: j.Heading || j.AbstractText || query, url: j.AbstractURL, source:'DuckDuckGo Abstract'}); }
      // Results array
      if(Array.isArray(j.Results)){
        j.Results.slice(0,6).forEach(it => {
          if(it.FirstURL) results.push({title: it.Text || it.Heading || it.Result || query, url: it.FirstURL, source:'DuckDuckGo Result'});
        });
      }
      // Related topics (may contain nested)
      if(Array.isArray(j.RelatedTopics)){
        j.RelatedTopics.slice(0,6).forEach(rt=>{
          if(rt.FirstURL) results.push({title: rt.Text || rt.Name || query, url: rt.FirstURL, source:'DuckDuckGo Related'});
          if(rt.Topics && Array.isArray(rt.Topics)) rt.Topics.slice(0,3).forEach(t2=>{ if(t2.FirstURL) results.push({title: t2.Text || t2.Name || query, url:t2.FirstURL, source:'DuckDuckGo Related'}); });
        });
      }
    }
  }catch(e){
    console.warn('ddg error', e);
  }

  // 2) Wikipedia search (action=query list=search)
  try{
    const wUrl = `https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*`;
    const r2 = await fetch(wUrl);
    if(r2.ok){
      const j2 = await r2.json();
      if(j2.query && Array.isArray(j2.query.search)){
        j2.query.search.slice(0,6).forEach(s=>{
          const title = s.title;
          const url = `https://en.wikipedia.org/wiki/${encodeURIComponent(title.replace(/ /g,'_'))}`;
          results.push({title: title, url, source:'Wikipedia'});
        });
      }
    }
  }catch(e){
    console.warn('wiki error', e);
  }

  // 3) Add ready search links (Google, YouTube) â€” not crawling, just links
  results.push({title:`Google search: ${query}`, url:`https://www.google.com/search?q=${encodeURIComponent(query)}`, source:'Search'});
  results.push({title:`YouTube search: ${query}`, url:`https://www.youtube.com/results?search_query=${encodeURIComponent(query)}`, source:'Search'});

  // dedupe by url
  const seen = new Set();
  const dedup = [];
  for(const r of results){
    if(!r.url) continue;
    const key = r.url.split('#')[0];
    if(!seen.has(key) && dedup.length < 30){ seen.add(key); dedup.push(r); }
  }

  // filter blocked
  const filtered = dedup.filter(it => !isBlocked(it.url));
  // render
  if(filtered.length === 0){
    magnetResults.innerHTML = `<div style="color:var(--muted)">Ù„Ø§ Ù†ØªØ§Ø¦Ø¬ Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø©.</div>`;
    return;
  }
  magnetResults.innerHTML = '';
  filtered.forEach(it=>{
    const card = document.createElement('div'); card.className='result-card';
    const meta = document.createElement('div'); meta.className='result-meta';
    meta.innerHTML = `<b>${it.title}</b><small>${it.source} â€” ${it.url}</small>`;
    const actions = document.createElement('div'); actions.style.display='flex'; actions.style.gap='8px';
    const addBtn = document.createElement('button'); addBtn.className='btn'; addBtn.textContent='Ø£Ø¶Ù Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø²Ù†Ø©';
    const openBtn = document.createElement('button'); openBtn.className='btn ghost'; openBtn.textContent='ÙØªØ­';
    actions.appendChild(addBtn); actions.appendChild(openBtn);
    card.appendChild(meta); card.appendChild(actions);
    magnetResults.appendChild(card);

    openBtn.addEventListener('click', ()=>{ window.open(it.url,'_blank'); log('magnet_open', it.url); });
    addBtn.addEventListener('click', ()=>{
      // add to vault apps
      const arr = JSON.parse(localStorage.getItem(STORAGE_APPS) || '[]');
      arr.unshift({title: it.title, url: it.url, cat: 'Magnet'});
      localStorage.setItem(STORAGE_APPS, JSON.stringify(arr));
      renderAppsGrid();
      log('magnet_add', it.url);
      addBtn.textContent = 'Ù…Ø¶Ø§Ù';
      addBtn.disabled = true;
    });
  });
}

/* magnet UI handlers */
magnetBtn.addEventListener('click', ()=> magnetPull(magnetQuery.value));
magnetClear.addEventListener('click', ()=>{ magnetQuery.value=''; magnetResults.innerHTML=''; });

/* init & render grid */
function init(){
  renderAppsGrid();
  renderLog();
  animateClose();
}
init();

/* allow Enter trigger on magnet and password */
passwordInput.addEventListener('keydown',(e)=>{ if(e.key==='Enter') unlockBtn.click(); });
magnetQuery.addEventListener('keydown',(e)=>{ if(e.key==='Enter') magnetBtn.click(); });

/* expose for console */
window.cherrak = { openVault: ()=>{ animateOpen(); loadVaultContent(); }, closeVault: animateClose, addGlobal: (t,u)=>{ const arr=JSON.parse(localStorage.getItem(STORAGE_APPS)||'[]'); arr.unshift({title:t,url:u}); localStorage.setItem(STORAGE_APPS, JSON.stringify(arr)); renderAppsGrid(); } };
</script>
</body>
</html>

